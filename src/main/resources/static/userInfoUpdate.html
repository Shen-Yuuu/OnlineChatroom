<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®æ”¹ä¸ªäººä¿¡æ¯</title>
    <script src="./js/vue.js"></script>
    <script src="./js/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .header h1 {
            font-size: 2.2rem;
            color: #3498db;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px 0;
        }

        .header::after {
            content: '';
            display: block;
            width: 60px;
            height: 4px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            margin: 0 auto;
            border-radius: 2px;
        }

        .content-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .update-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .update-card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .card-header h2 {
            font-size: 1.8rem;
            letter-spacing: 1px;
        }

        .form-container {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 40px;
            color: #3498db;
            font-size: 18px;
        }

        .form-input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .form-input:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        textarea.form-input {
            min-height: 120px;
            padding-left: 15px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-item input {
            width: 18px;
            height: 18px;
            accent-color: #3498db;
        }

        .gender-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .male-icon {
            background-color: #3498db;
        }

        .female-icon {
            background-color: #e84393;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 100%);
            color: white;
        }

        .btn-secondary {
            background: #f1f1f1;
            color: #2c3e50;
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-size: 16px;
            display: none;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .user-avatar {
            text-align: center;
            margin-bottom: 20px;
        }

        .avatar-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db 0%, #2ecc71 100%);
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div id="update-app">
    <div class="header">
        <h1>ä¿®æ”¹ä¸ªäººä¿¡æ¯</h1>
    </div>

    <div class="content-container">
        <div v-if="loading" class="loading">
            <div class="spinner"></div>
        </div>

        <div v-else class="update-card">
            <div class="card-header">
                <h2>ç¼–è¾‘æ‚¨çš„ä¸ªäººèµ„æ–™</h2>
            </div>

            <div class="form-container">
                <div class="user-avatar">
                    <div class="avatar-circle">
                        {{ user.username.charAt(0) }}
                    </div>
                </div>

                <form @submit.prevent="submitForm">
                    <div class="form-group">
                        <label for="username">ç”¨æˆ·å</label>
                        <div class="input-icon">ğŸ‘¤</div>
                        <input
                                type="text"
                                id="username"
                                class="form-input"
                                placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                                v-model="user.username"
                                required
                        >
                    </div>

                    <div class="form-group">
                        <label for="userpassword">å¯†ç </label>
                        <div class="input-icon">ğŸ”’</div>
                        <input
                                type="text"
                                id="userpassword"
                                class="form-input"
                                placeholder="è¯·è¾“å…¥å¯†ç "
                                v-model="user.password"
                        >
                    </div>

                    <div class="form-group">
                        <label>æ€§åˆ«</label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input
                                        type="radio"
                                        value="1"
                                        v-model="user.gender"
                                >
                                <span class="gender-icon male-icon"></span> ç”·
                            </label>
                            <label class="radio-item">
                                <input
                                        type="radio"
                                        value="0"
                                        v-model="user.gender"
                                >
                                <span class="gender-icon female-icon"></span> å¥³
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="description">ä¸ªæ€§ç­¾å</label>
                        <textarea
                                id="description"
                                class="form-input"
                                placeholder="åˆ†äº«æ‚¨çš„ä¸ªæ€§å®£è¨€..."
                                v-model="user.description"
                        ></textarea>
                    </div>

                    <div class="status-message" :class="statusClass">{{ statusMessage }}</div>

                    <div class="btn-group">
                        <button
                                type="submit"
                                class="btn btn-primary"
                                :disabled="submitting"
                        >
                            <span v-if="submitting">ä¿å­˜ä¸­...</span>
                            <span v-else>ä¿å­˜æ›´æ”¹</span>
                        </button>
                        <button
                                type="button"
                                class="btn btn-secondary"
                                @click="goBack"
                        >
                            è¿”å›
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    new Vue({
        el: "#update-app",
        data: {
            user: {
                userId: null,
                username: "",
                gender: "1", // é»˜è®¤é€‰ä¸­ç”·æ€§
                description: "",
                password:""
            },
            loading: true,
            submitting: false,
            statusMessage: "",
            statusClass: ""
        },
        created() {
            this.loadUserData();
        },
        methods: {
            // ä»URLå‚æ•°è·å–ç”¨æˆ·ID
            getUserIdFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get('userId');
            },

            // åŠ è½½ç”¨æˆ·æ•°æ®
            loadUserData() {
                const userId = this.getUserIdFromUrl();
                if (!userId) {
                    this.showError("æœªè·å–åˆ°ç”¨æˆ·ID");
                    return;
                }

                // æ¨¡æ‹ŸAPIå“åº”
                setTimeout(() => {
                    const mockUserData = {
                        userId: 0,
                        username: "",
                        gender: 1,
                        description: "",
                        password:""
                    };

                    axios.get('/userInfo1').then((response) => {
                        console.log(response)
                        if (response!=null) {
                            console.log(response.data.data)
                            mockUserData.userId = response.data.userId
                            mockUserData.username = response.data.username
                            mockUserData.gender = response.data.gender
                            mockUserData.description = response.data.description
                            mockUserData.password = response.data.password
                        }
                        this.user = {
                            ...mockUserData,
                            // å°†æ•°å€¼å‹genderè½¬æ¢ä¸ºå­—ç¬¦ä¸²å‹
                            gender: mockUserData.gender.toString()
                        };
                        this.loading = false;
                    })
                }, 100);
            },

            // æäº¤è¡¨å•
            submitForm() {
                this.submitting = true;
                this.clearStatus();

                // ç®€å•éªŒè¯
                if (!this.user.username.trim()) {
                    this.showError("ç”¨æˆ·åä¸èƒ½ä¸ºç©º");
                    this.submitting = false;
                    return;
                }

                if (this.user.username.length > 20) {
                    this.showError("ç”¨æˆ·åä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦");
                    this.submitting = false;
                    return;
                }

                // è½¬æ¢ä¸ºæ•°å€¼å‹
                const submitData = {
                    ...this.user,
                    gender: parseInt(this.user.gender)
                };

                // å®é™…åº”è¯¥ä½¿ç”¨:
                axios.post('/updateUser', submitData).then((response) => {
                    console.log(response)
                    if(response!=null||response!=="") {
                        setTimeout(() => {
                            console.log("æäº¤æ•°æ®:", submitData);
                            this.submitting = false;
                            this.showSuccess("ä¸ªäººä¿¡æ¯æ›´æ–°æˆåŠŸï¼");

                            // æ ¹æ®å¯†ç æ˜¯å¦ä¸ºç©ºå†³å®šè·³è½¬é¡µé¢
                            if (this.user.password.trim() === "") {
                                // å¯†ç ä¸ºç©ºï¼Œè·³è½¬åˆ°userinfo.html
                                setTimeout(() => {
                                    this.goToProfile();
                                }, 1000);
                            } else {
                                // å¯†ç ä¸ä¸ºç©ºï¼Œè·³è½¬åˆ°login.html
                                setTimeout(() => {
                                    window.location.href = "login.html";
                                }, 1000);
                            }
                        }, 1500);
                    }else{
                        this.showError("ä¸ªäººä¿¡æ¯æ›´æ–°å¤±è´¥");
                    }
                })
            },

            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showSuccess(message) {
                this.statusMessage = message;
                this.statusClass = "success";
            },

            // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
            showError(message) {
                this.statusMessage = message;
                this.statusClass = "error";
            },

            // æ¸…é™¤çŠ¶æ€æ¶ˆæ¯
            clearStatus() {
                this.statusMessage = "";
                this.statusClass = "";
            },

            // è¿”å›ä¸ªäººä¿¡æ¯é¡µ
            goToProfile() {
                window.location.href = `userInfo.html?userId=${this.user.userId}`;
            },

            // è¿”å›ä¸Šä¸€é¡µ
            goBack() {
                window.history.back();
            }
        }
    });
</script>
</body>
</html>